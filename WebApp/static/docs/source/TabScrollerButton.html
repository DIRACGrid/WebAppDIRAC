<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='Ext-dirac-views-tabs-TabScrollerButton-method-constructor'><span id='Ext-dirac-views-tabs-TabScrollerButton'>/**
</span></span> * @class Ext.dirac.views.tabs.TabScrollerButton
 * @extends Ext.button.Button
 * @constructor
 * @param {Object}
 *          config Configuration options It is a reimplemenatation of the
 *          Ext.dirac.views.tabs.TabScrollerMenu plugin. It generates a menu
 *          based on the tab panel.
 */
Ext.define(&#39;Ext.dirac.views.tabs.TabScrollerButton&#39;, {
      extend : &#39;Ext.button.Button&#39;,
      alias : &#39;widget.tabscrollerbutton&#39;,

      requires : [&#39;Ext.menu.Menu&#39;],

<span id='Ext-dirac-views-tabs-TabScrollerButton-property-iconCls'>      iconCls : &#39;dirac-icon-list&#39;,
</span><span id='Ext-dirac-views-tabs-TabScrollerButton-cfg-pageSize'>      /**
</span>       * @cfg {Number} pageSize How many items to allow per submenu.
       */
      pageSize : 10,
<span id='Ext-dirac-views-tabs-TabScrollerButton-cfg-maxText'>      /**
</span>       * @cfg {Number} maxText How long should the title of each
       *      {@link Ext.menu.Item} be.
       */
      maxText : 15,
<span id='Ext-dirac-views-tabs-TabScrollerButton-cfg-menuPrefixText'>      /**
</span>       * @cfg {String} menuPrefixText Text to prefix the submenus.
       */
      menuPrefixText : &#39;Items&#39;,
      
      constructor : function(config) {
        var me = this;
        Ext.apply(me, config);
        me.callParent(arguments);
        me.on(&#39;click&#39;, me.showTabsMenu, me);
      },

<span id='Ext-dirac-views-tabs-TabScrollerButton-method-getPageSize'>      /**
</span>       * Returns an the current page size (this.pageSize);
       * 
       * @return {Number} this.pageSize The current page size.
       */
      getPageSize : function() {
        return this.pageSize;
      },
<span id='Ext-dirac-views-tabs-TabScrollerButton-method-setPageSize'>      /**
</span>       * Sets the number of menu items per submenu &quot;page size&quot;.
       * 
       * @param {Number}
       *          pageSize The page size
       */
      setPageSize : function(pageSize) {
        this.pageSize = pageSize;
      },
<span id='Ext-dirac-views-tabs-TabScrollerButton-method-getMaxText'>      /**
</span>       * Returns the current maxText length;
       * 
       * @return {Number} this.maxText The current max text length.
       */
      getMaxText : function() {
        return this.maxText;
      },
<span id='Ext-dirac-views-tabs-TabScrollerButton-method-setMaxText'>      /**
</span>       * Sets the maximum text size for each menu item.
       * 
       * @param {Number}
       *          t The max text per each menu item.
       */
      setMaxText : function(t) {
        this.maxText = t;
      },
<span id='Ext-dirac-views-tabs-TabScrollerButton-method-getMenuPrefixText'>      /**
</span>       * Returns the current menu prefix text String.;
       * 
       * @return {String} this.menuPrefixText The current menu prefix text.
       */
      getMenuPrefixText : function() {
        return this.menuPrefixText;
      },
<span id='Ext-dirac-views-tabs-TabScrollerButton-method-setMenuPrefixText'>      /**
</span>       * Sets the menu prefix text String.
       * 
       * @param {String}
       *          t The menu prefix text.
       */
      setMenuPrefixText : function(t) {
        this.menuPrefixText = t;
      },

<span id='Ext-dirac-views-tabs-TabScrollerButton-method-showTabsMenu'>      showTabsMenu : function(e) {
</span>        var me = this;

        if (me.tabsMenu) {
          me.tabsMenu.removeAll();
        } else {
          me.tabsMenu = new Ext.menu.Menu();
          me.tabPanel.on(&#39;destroy&#39;, me.tabsMenu.destroy, me.tabsMenu);
        }

        me.generateTabMenuItems();

        var target = e.getTargetEl(), xy = target.getXY();

        // Y param + 24 pixels
        xy[1] += 24;

        me.tabsMenu.showAt(xy);
      },

<span id='Ext-dirac-views-tabs-TabScrollerButton-method-generateTabMenuItems'>      // private
</span>      generateTabMenuItems : function() {
        var me = this, tabPanel = me.tabPanel, curActive = tabPanel.getActiveTab(), allItems = tabPanel.items.getRange(), pageSize = me.getPageSize(), tabsMenu = me.tabsMenu, totalItems, numSubMenus, remainder, i, curPage, menuItems, x, item, start, index;

        tabsMenu.suspendLayouts();
        allItems = Ext.Array.filter(allItems, function(item) {
              if (curActive &amp;&amp; item.id == curActive.id) {
                return false;
              }
              return item.hidden ? !!item.hiddenByLayout : true;
            });
        totalItems = allItems.length;
        numSubMenus = Math.floor(totalItems / pageSize);
        remainder = totalItems % pageSize;

        if (totalItems &gt; pageSize) {

          // Loop through all of the items and create submenus in chunks of 10
          for (i = 0; i &lt; numSubMenus; i++) {
            curPage = (i + 1) * pageSize;
            menuItems = [];

            for (x = 0; x &lt; pageSize; x++) {
              index = x + curPage - pageSize;
              item = allItems[index];
              menuItems.push(me.autoGenMenuItem(item));
            }

            tabsMenu.add({
                  text : me.getMenuPrefixText() + &#39; &#39; + (curPage - pageSize + 1) + &#39; - &#39; + curPage,
                  menu : menuItems
                });
          }
          // remaining items
          if (remainder &gt; 0) {
            start = numSubMenus * pageSize;
            menuItems = [];
            for (i = start; i &lt; totalItems; i++) {
              item = allItems[i];
              menuItems.push(me.autoGenMenuItem(item));
            }

            me.tabsMenu.add({
                  text : me.menuPrefixText + &#39; &#39; + (start + 1) + &#39; - &#39; + (start + menuItems.length),
                  menu : menuItems
                });

          }
        } else {
          for (i = 0; i &lt; totalItems; ++i) {
            tabsMenu.add(me.autoGenMenuItem(allItems[i]));
          }
        }
        tabsMenu.resumeLayouts(true);
      },

<span id='Ext-dirac-views-tabs-TabScrollerButton-method-autoGenMenuItem'>      // private
</span>      autoGenMenuItem : function(item) {
        var maxText = this.getMaxText(), text = Ext.util.Format.ellipsis(item.title, maxText);

        return {
          text : text,
          handler : this.showTabFromMenu,
          scope : this,
          disabled : item.disabled,
          tabToShow : item,
          iconCls : item.iconCls
        };
      },

<span id='Ext-dirac-views-tabs-TabScrollerButton-method-showTabFromMenu'>      // private
</span>      showTabFromMenu : function(menuItem) {
        this.tabPanel.setActiveTab(menuItem.tabToShow);
      }
    });
</pre>
</body>
</html>
