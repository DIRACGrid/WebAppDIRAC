<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='Ext-ux-grid-Printer'>/**
</span> * @class Ext.ux.grid.Printer
 * @author Ed Spencer (edward@domine.co.uk)
 * Helper class to easily print the contents of a grid. Will open a new window with a table where the first row
 * contains the headings from your column model, and with a row for each item in your grid&#39;s store. When formatted
 * with appropriate CSS it should look very similar to a default grid. If renderers are specified in your column
 * model, they will be used in creating the table. Override headerTpl and bodyTpl to change how the markup is generated
 * 
 * Usage:
 * 
 * 1 - Add Ext.Require Before the Grid code
 * Ext.require([
 *   &#39;Ext.ux.grid.GridPrinter&#39;,
 * ]);
 * 
 * 2 - Declare the Grid 
 * var grid = Ext.create(&#39;Ext.grid.Panel&#39;, {
 *   columns: //some column model,
 *   store   : //some store
 * });
 * 
 * 3 - Print!
 * Ext.ux.grid.Printer.mainTitle = &#39;Your Title here&#39;; //optional
 * Ext.ux.grid.Printer.print(grid);
 * 
 * Original url: http://edspencer.net/2009/07/printing-grids-with-ext-js.html
 * 
 * Modified by Loiane Groner (me@loiane.com) - September 2011 - Ported to Ext JS 4
 * http://loianegroner.com (English)
 * http://loiane.com (Portuguese)
 * 
 * Modified by Bruno Sales - August 2012
 * 
 * Modified by Paulo Goncalves - March 2012
 * 
 * Modified by Beto Lima - March 2012
 * 
 * Modified by Beto Lima - April 2012
 *
 * Modified by Paulo Goncalves - May 2012
 * 
 * Modified by Nielsen Teixeira - 2012-05-02
 *
 * Modified by Joshua Bradley - 2012-06-01
 * 
 * Modified by Loiane Groner - 2012-09-08
  * 
 * Modified by Loiane Groner - 2012-09-24
 *
 */
Ext.define(&quot;Ext.dirac.utils.Printer&quot;, {
    
    requires: &#39;Ext.XTemplate&#39;,

    statics: {
<span id='Ext-ux-grid-Printer-static-method-print'>        /**
</span>         * Prints the passed grid. Reflects on the grid&#39;s column model to build a table, and fills it using the store
         * @param {Ext.grid.Panel} grid The grid to print
         */
        print: function(grid) {
            //We generate an XTemplate here by using 2 intermediary XTemplates - one to create the header,
            //the other to create the body (see the escaped {} below)
            var columns = [];
            //account for grouped columns
            Ext.each(grid.columns, function(c) {
                if(c.items.length &gt; 0) {
                    columns = columns.concat(c.items.items);
                } else {
                    columns.push(c);
                }
            });

            //build a usable array of store data for the XTemplate
            var data = [];
            grid.store.data.each(function(item, row) {
                var convertedData = {};

                //apply renderers from column model
                for (var key in item.data) {
                    var value = item.data[key];

                    Ext.each(columns, function(column, col) {
                        if (column &amp;&amp; column.dataIndex == key) {
                            /*
                             * TODO: add the meta to template
                             */
                            var meta = {item: &#39;&#39;, tdAttr: &#39;&#39;, style: &#39;&#39;};
                            value = column.renderer ? column.renderer.call(grid, value, meta, item, row, col, grid.store, grid.view) : value;
                            convertedData[Ext.String.createVarName(column.text)] = value;
                        } else if (column &amp;&amp; column.xtype === &#39;rownumberer&#39;){
              convertedData[&#39;Row&#39;] = row;
            }
                    }, this);
                }

                data.push(convertedData);
            });
            
            //remove columns that do not contains dataIndex or dataIndex is empty. for example: columns filter or columns button
            var clearColumns = [];
            Ext.each(columns, function (column) {
                if ((column) &amp;&amp; (!Ext.isEmpty(column.dataIndex) &amp;&amp; !column.hidden)) {
                    clearColumns.push(column);
                } else  if (column &amp;&amp; column.xtype === &#39;rownumberer&#39;){
          column.text = &#39;Row&#39;;
          clearColumns.push(column);
        }
            });
            columns = clearColumns;
            
            //get Styles file relative location, if not supplied
            if (this.stylesheetPath === null) {
                var scriptPath = Ext.Loader.getPath(&#39;Ext.dirac.utils.Printer&#39;);
                this.stylesheetPath = scriptPath.substring(0, scriptPath.indexOf(&#39;Printer.js&#39;)) + &#39;css/print.css&#39;;
            }

            //use the headerTpl and bodyTpl markups to create the main XTemplate below
            var headings = Ext.create(&#39;Ext.XTemplate&#39;, this.headerTpl).apply(columns);
            var body     = Ext.create(&#39;Ext.XTemplate&#39;, this.bodyTpl).apply(columns);
            var pluginsBody = &#39;&#39;,
                pluginsBodyMarkup = [];
            
            //add relevant plugins
            Ext.each(grid.plugins, function(p) {
                if (p.ptype == &#39;rowexpander&#39;) {
                    pluginsBody += p.rowBodyTpl.join(&#39;&#39;);
                }
            });
            
            if (pluginsBody != &#39;&#39;) {
                pluginsBodyMarkup = [
                    &#39;&lt;tr class=&quot;{[xindex % 2 === 0 ? &quot;even&quot; : &quot;odd&quot;]}&quot;&gt;&lt;td colspan=&quot;&#39; + columns.length + &#39;&quot;&gt;&#39;,
                      pluginsBody,
                    &#39;&lt;/td&gt;&lt;/tr&gt;&#39;
                ];
            }
            
            //Here because inline styles using CSS, the browser did not show the correct formatting of the data the first time that loaded
            var htmlMarkup = [
                &#39;&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;&#39;,
                &#39;&lt;html class=&quot;&#39; + Ext.baseCSSPrefix + &#39;ux-grid-printer&quot;&gt;&#39;,
                  &#39;&lt;head&gt;&#39;,
                    &#39;&lt;meta content=&quot;text/html; charset=UTF-8&quot; http-equiv=&quot;Content-Type&quot; /&gt;&#39;,
                    &#39;&lt;link href=&quot;&#39; + this.stylesheetPath + &#39;&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot; /&gt;&#39;,
                    &#39;&lt;title&gt;&#39; + grid.title + &#39;&lt;/title&gt;&#39;,
                  &#39;&lt;/head&gt;&#39;,
                  &#39;&lt;body class=&quot;&#39; + Ext.baseCSSPrefix + &#39;ux-grid-printer-body&quot;&gt;&#39;,
                  &#39;&lt;div class=&quot;&#39; + Ext.baseCSSPrefix + &#39;ux-grid-printer-noprint &#39; + Ext.baseCSSPrefix + &#39;ux-grid-printer-links&quot;&gt;&#39;,
                      &#39;&lt;a class=&quot;&#39; + Ext.baseCSSPrefix + &#39;ux-grid-printer-linkprint&quot; href=&quot;javascript:void(0);&quot; onclick=&quot;window.print();&quot;&gt;&#39; + this.printLinkText + &#39;&lt;/a&gt;&#39;,
                      &#39;&lt;a class=&quot;&#39; + Ext.baseCSSPrefix + &#39;ux-grid-printer-linkclose&quot; href=&quot;javascript:void(0);&quot; onclick=&quot;window.close();&quot;&gt;&#39; + this.closeLinkText + &#39;&lt;/a&gt;&#39;,
                  &#39;&lt;/div&gt;&#39;,
                  &#39;&lt;h1&gt;&#39; + this.mainTitle + &#39;&lt;/h1&gt;&#39;,
                    &#39;&lt;table&gt;&#39;,
                      &#39;&lt;tr&gt;&#39;,
                        headings,
                      &#39;&lt;/tr&gt;&#39;,
                      &#39;&lt;tpl for=&quot;.&quot;&gt;&#39;,
                        &#39;&lt;tr class=&quot;{[xindex % 2 === 0 ? &quot;even&quot; : &quot;odd&quot;]}&quot;&gt;&#39;,
                          body,
                        &#39;&lt;/tr&gt;&#39;,
                        pluginsBodyMarkup.join(&#39;&#39;),
                      &#39;&lt;/tpl&gt;&#39;,
                    &#39;&lt;/table&gt;&#39;,
                  &#39;&lt;/body&gt;&#39;,
                &#39;&lt;/html&gt;&#39;           
            ];

            var html = Ext.create(&#39;Ext.XTemplate&#39;, htmlMarkup).apply(data); 

            //open up a new printing window, write to it, print it and close
            var win = window.open(&#39;&#39;, &#39;printgrid&#39;);
            
            //document must be open and closed
            win.document.open();
            win.document.write(html);
            win.document.close();
            
            if (this.printAutomatically){
                win.print();
            }
            
            //Another way to set the closing of the main
            if (this.closeAutomaticallyAfterPrint){
                if(Ext.isIE){
                    window.close();
                } else {
                    win.close();
                }                
            }
        },

<span id='Ext-ux-grid-Printer-static-property-stylesheetPath'>        /**
</span>         * @property stylesheetPath
         * @type String
         * The path at which the print stylesheet can be found (defaults to &#39;ux/grid/gridPrinterCss/print.css&#39;)
         */
        stylesheetPath: null,
        
<span id='Ext-ux-grid-Printer-static-property-printAutomatically'>        /**
</span>         * @property printAutomatically
         * @type Boolean
         * True to open the print dialog automatically and close the window after printing. False to simply open the print version
         * of the grid (defaults to false)
         */
        printAutomatically: false,
        
<span id='Ext-ux-grid-Printer-static-property-closeAutomaticallyAfterPrint'>        /**
</span>         * @property closeAutomaticallyAfterPrint
         * @type Boolean
         * True to close the window automatically after printing.
         * (defaults to false)
         */
        closeAutomaticallyAfterPrint: false,        
        
<span id='Ext-ux-grid-Printer-static-property-mainTitle'>        /**
</span>         * @property mainTitle
         * @type String
         * Title to be used on top of the table
         * (defaults to empty)
         */
        mainTitle: &#39;&#39;,
        
<span id='Ext-ux-grid-Printer-static-property-printLinkText'>        /**
</span>         * Text show on print link
         * @type String
         */
        printLinkText: &#39;Print&#39;,
        
<span id='Ext-ux-grid-Printer-static-property-closeLinkText'>        /**
</span>         * Text show on close link
         * @type String
         */
        closeLinkText: &#39;Close&#39;,
        
<span id='Ext-ux-grid-Printer-static-property-headerTpl'>        /**
</span>         * @property headerTpl
         * @type {Object/Array} values
         * The markup used to create the headings row. By default this just uses &lt;th&gt; elements, override to provide your own
         */
        headerTpl: [ 
            &#39;&lt;tpl for=&quot;.&quot;&gt;&#39;,
                &#39;&lt;th&gt;{text}&lt;/th&gt;&#39;,
            &#39;&lt;/tpl&gt;&#39;
        ],

<span id='Ext-ux-grid-Printer-static-property-bodyTpl'>        /**
</span>         * @property bodyTpl
         * @type {Object/Array} values
         * The XTemplate used to create each row. This is used inside the &#39;print&#39; function to build another XTemplate, to which the data
         * are then applied (see the escaped dataIndex attribute here - this ends up as &quot;{dataIndex}&quot;)
         */
        bodyTpl: [
            &#39;&lt;tpl for=&quot;.&quot;&gt;&#39;,
                &#39;&lt;td&gt;\{{[Ext.String.createVarName(values.text)]}\}&lt;/td&gt;&#39;,
            &#39;&lt;/tpl&gt;&#39;
        ]
    }
});</pre>
</body>
</html>
