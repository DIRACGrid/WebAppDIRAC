<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='Ext-dirac-utils-DiracApplicationContextMenu'>/*******************************************************************************
</span> * It can be used to create a context menu. NOTE: You have to provide the menu
 * items and the scope. The menuitems is a dictionary which has Visible and
 * Protected keys: -Visible: the menu items accessible by all users. -Protected:
 * the menu items are restricted. Only the appropriate users can be accessed to
 * this functionalities. For example: only the users can access to the menu
 * items which are a certain group. These to items are lists which contain
 * dictionaries used to configure the menu items.:
 * {&#39;Visible&#39;:[{}],&#39;Protected&#39;,&#39;Protected&#39;:[{}]} The dictionaries have the
 * following format: {&quot;text&quot;:&quot;a&quot;,&quot;handler&quot;:func,&quot;arguments&quot;:[a,b,c],
 * properties:{}} -text: the menu item name (this text will appears in the menu)
 * -handler: this function handle the event. -arguments: we can pass parameters
 * to the func method. -properties: We can provide properties which are
 * properties of the {@link Ext.menu.Menu}. -property: It is used when the menu
 * item is protected. (We allow to use the functionalities to a certain users.
 * 
 * 
 * var sandboxSubmenu = { &#39;Visible&#39;:[ {&quot;text&quot;:&quot;Get input file(s)&quot;,
 * &quot;handler&quot;:me.__getSandbox,&quot;arguments&quot;:[GLOBAL.APP.CF.getFieldValueFromSelectedRow(me.grid,
 * &quot;JobID&quot;), &quot;Input&quot;],&quot;properties&quot;:{tooltip:&#39;Click to kill the selected
 * job.&#39;,iconCls : &quot;dirac-icon-download&quot;}}, {&quot;text&quot;:&quot;Get output file(s)&quot;,
 * &quot;handler&quot;:me.__getSandbox,&quot;arguments&quot;:[GLOBAL.APP.CF.getFieldValueFromSelectedRow(me.grid,
 * &quot;JobID&quot;), &quot;Output&quot;],&quot;properties&quot;:{tooltip:&#39;Click to kill the selected
 * job.&#39;,iconCls : &quot;dirac-icon-download&quot;}} ]};
 * 
 * var menuitems = { &#39;Visible&#39;:[ {&quot;text&quot;:&quot;JDL&quot;, &quot;handler&quot;:me.__oprGetJobData,
 * &quot;arguments&quot;:[&quot;getJDL&quot;], &quot;properties&quot;:{tooltip:&#39;Click to show the JDL of the
 * selected job.&#39;}}, {&quot;text&quot;:&quot;-&quot;},//separator {&quot;text&quot;:&quot;Attributes&quot;,
 * &quot;handler&quot;:me.__oprGetJobData, &quot;arguments&quot;:[&quot;getBasicInfo&quot;],
 * &quot;properties&quot;:{tooltip:&#39;Click to show the attributtes of the selected job.&#39;}},
 * {&quot;text&quot;:&quot;SandBox&quot;, &quot;subMenu&quot;: sandboxSubmenu, &quot;properties&quot;:{iconCls :
 * &quot;jm-icon-sandbox&quot;,}} ]} me.contextGridMenu = new
 * Ext.dirac.utils.DiracApplicationContextMenu({menu:menuitems,scope:me});
 * 
 */
Ext.define(&#39;Ext.dirac.utils.DiracApplicationContextMenu&#39;, {
      extend : &#39;Ext.menu.Menu&#39;,
<span id='Ext-dirac-utils-DiracApplicationContextMenu-cfg-is'>      /**
</span>       * @cfg{menuitems} is a dictionary which contains the menu items. More
       *                 details in above.
       */
      menuitems : null,

<span id='Ext-dirac-utils-DiracApplicationContextMenu-property-dynamicShow'>      dynamicShow : false,
</span>
<span id='Ext-dirac-utils-DiracApplicationContextMenu-method-constructor'>      constructor : function(oConfig) {
</span>        var me = this;
        me.callParent(arguments);
        if (oConfig.scope) {
          Ext.apply(me, {
                scope : oConfig.scope
              });
        }
        if (oConfig) {
          me.dynamicShow = oConfig.dynamicShow;
          if (oConfig.menu &amp;&amp; &quot;Visible&quot; in oConfig.menu &amp;&amp; oConfig.menu.Visible.length &gt; 0) {
            for (var i = 0; i &lt; oConfig.menu.Visible.length; i++) {
              var oMenuItem = null;
              if (oConfig.menu.Visible[i].text == &quot;-&quot;) {
                me.add(new Ext.menu.Separator());
              } else if (&quot;handler&quot; in oConfig.menu.Visible[i]) {
                oMenuItem = new Ext.menu.Item({
                      text : oConfig.menu.Visible[i].text,
                      handler : Ext.bind(oConfig.menu.Visible[i].handler, me.scope, oConfig.menu.Visible[i].arguments, false),
                      scope : me.scope
                    });
              } else if (&quot;subMenu&quot; in oConfig.menu.Visible[i]) {
                oMenuItem = new Ext.menu.Item({
                      text : oConfig.menu.Visible[i].text
                    });
                me.__createSubmenu(oMenuItem, oConfig.menu.Visible[i].subMenu);
              }
              if (oConfig.menu.Visible[i].properties) {
                Ext.apply(oMenuItem, oConfig.menu.Visible[i].properties);
              }
              if (oConfig.menu.Visible[i].checkField) {
                oMenuItem.checkField = oConfig.menu.Visible[i].checkField;
              }
              me.add(oMenuItem);

            }
          }
          if (oConfig.menu &amp;&amp; &quot;Protected&quot; in oConfig.menu &amp;&amp; oConfig.menu.Protected.length &gt; 0) {
            for (var i = 0; i &lt; oConfig.menu.Protected.length; i++) {
              var oMenuItem = null;
              if (oConfig.menu.Protected[i].text == &quot;-&quot;) {
                me.add(new Ext.menu.Separator());
              } else if (&quot;handler&quot; in oConfig.menu.Protected[i]) {
                oMenuItem = new Ext.menu.Item({
                      text : oConfig.menu.Protected[i].text,
                      handler : Ext.bind(oConfig.menu.Protected[i].handler, me.scope, oConfig.menu.Protected[i].arguments, false),
                      scope : me.scope
                    });
              } else if (&quot;subMenu&quot; in oConfig.menu.Protected[i]) {
                oMenuItem = new Ext.menu.Item({
                      text : oConfig.menu.Protected[i].text
                    });
                me.__createSubmenu(oMenuItem, oConfig.menu.Protected[i].subMenu);
              }
              if (oConfig.menu.Protected[i].properties) {
                Ext.apply(oMenuItem, oConfig.menu.Protected[i].properties);
              }
              if (oConfig.menu.Protected[i].checkField) {
                oMenuItem.checkField = oConfig.menu.Protected[i].checkField;
              }
              me.add(oMenuItem);

            }
          }
        }
      },
<span id='Ext-dirac-utils-DiracApplicationContextMenu-method-__createSubmenu'>      /**
</span>       * It is used to create sub menu to a given menu item.
       * 
       * @param{Ext.menu.Item} oMenu the sub menu will belong to this menu item.
       * @param{Object} subMenu it contains the menu items the format is same as
       *                the {@link #menuitems}
       */
      __createSubmenu : function(oMenu, subMenu) {
        var me = this;
        oMenu.menu = new Ext.menu.Menu();
        if (subMenu == null) {
          return;
        } else {
          if (&quot;Visible&quot; in subMenu) {
            for (var i = 0; i &lt; subMenu.Visible.length; i++) {
              if (subMenu.Visible[i].text == &quot;-&quot;) {
                oMenu.menu.add(new Ext.menu.Separator());
              } else if (&quot;handler&quot; in subMenu.Visible[i]) {
                var oMenuItem = new Ext.menu.Item({
                      text : subMenu.Visible[i].text,
                      handler : Ext.bind(subMenu.Visible[i].handler, me.scope, subMenu.Visible[i].arguments, false),
                      scope : me.scope
                    });
              } else if (&quot;subMenu&quot; in subMenu.Visible[i]) {
                var oMenuItem = new Ext.menu.Item({
                      text : oConfig.menu.Visible[i].text
                    })
                me.__createSubmenu(oMenuItem, oConfig.menu.Visible[i].subMenu);
                oMenu.menu.add(oMenuItem);
              }
              if (subMenu.Visible[i].properties) {
                Ext.apply(oMenuItem, subMenu.Visible[i].properties);
              }
              if (subMenu.Visible[i].checkField) {
                oMenuItem.checkField = subMenu.Visible[i].checkField;
              }
              oMenu.menu.add(oMenuItem);
            }
          } else if (&quot;Protected&quot; in subMenu) {
            for (var i = 0; i &lt; subMenu.Protected.length; i++) {
              var lDisable = (&quot;properties&quot; in GLOBAL.USER_CREDENTIALS) &amp;&amp; (Ext.Array.indexOf(GLOBAL.USER_CREDENTIALS.properties, subMenu.Protected[i].property) != -1) == false ? true : false;
              oMenu.disabled = lDisable;
              if (subMenu.Protected[i].text == &quot;-&quot;) {
                oMenu.menu.add(new Ext.menu.Separator());
              } else if (&quot;handler&quot; in subMenu.Protected[i]) {
                var oMenuItem = new Ext.menu.Item({
                      text : subMenu.Protected[i].text,
                      handler : Ext.bind(subMenu.Protected[i].handler, me.scope, subMenu.Protected[i].arguments, false),
                      scope : me.scope,
                      disabled : lDisable
                    });
              } else if (&quot;subMenu&quot; in subMenu.Protected[i]) {
                var oMenuItem = new Ext.menu.Item({
                      text : oConfig.menu.Protected[i].text,
                      disabled : lDisable,
                      checkField : oConfig.menu.Protected[i].checkField
                    });
                me.__createSubmenu(oMenuItem, oConfig.menu.Protected[i].subMenu);
                oMenu.menu.add(oMenuItem);
              }
              if (subMenu.Protected[i].properties) {
                Ext.apply(oMenuItem, subMenu.Protected[i].properties);
              }
              if (subMenu.Protected[i].checkField) {
                oMenuItem.checkField = subMenu.Protected[i].checkField;
              }
              oMenu.menu.add(oMenuItem);
            }
          }

        }
      },
<span id='Ext-dirac-utils-DiracApplicationContextMenu-method-doSow'>      doSow : function(record) {
</span>        var me = this;
        for (var i = 0; i &lt; me.items.length; i++) {
          var menuItem = me.items.getAt(i);
          for (var key in menuItem.checkField) {
            if (key == &quot;property&quot;)
              continue; // it is not a condition...
            if (record.get(key) == menuItem.checkField[key]) {
              switch (menuItem.checkField[&quot;property&quot;]) {
                case &quot;disable&quot; :
                  me.items.getAt(i).enable();
                  break;
                case &quot;hide&quot; :
                  me.items.getAt(i).hide();
                  break;
                default :
                  me.items.getAt(i).enable();
              }
            } else {
              switch (menuItem.checkField[&quot;property&quot;]) {
                case &quot;disable&quot; :
                  me.items.getAt(i).disable();
                  break;
                case &quot;hide&quot; :
                  me.items.getAt(i).show();
                  break;
                default :
                  me.items.getAt(i).show();
              }
            }
          }

        }
      }

    });
</pre>
</body>
</html>
