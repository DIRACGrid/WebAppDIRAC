<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='Ext-dirac-views-desktop-TaskBar'>/**
</span> * @class Ext.dirac.views.desktop.TaskBar The taskbar class. An object of this
 *        class has three main parts: - Start menu - Quick start menu - Window
 *        bar (syn. task bar)
 * @extends Ext.toolbar.Toolbar
 */
Ext.define(&#39;Ext.dirac.views.desktop.TaskBar&#39;, {
	extend : &#39;Ext.toolbar.Toolbar&#39;, // TODO - make this a basic hbox panel...

	requires : [ &#39;Ext.button.Button&#39;, &#39;Ext.resizer.Splitter&#39;, &#39;Ext.menu.Menu&#39;, &#39;Ext.dirac.views.desktop.StartMenu&#39;, &#39;Ext.toolbar.TextItem&#39; ],

	alias : &#39;widget.taskbar&#39;,

<span id='Ext-dirac-views-desktop-TaskBar-property-cls'>	cls : &#39;ux-taskbar&#39;,
</span>
<span id='Ext-dirac-views-desktop-TaskBar-cfg-startBtnText'>	/**
</span>	 * @cfg {String} startBtnText The text for the Start Button.
	 */
	startBtnText : &#39;&#39;,

<span id='Ext-dirac-views-desktop-TaskBar-property-height'>	height : 28,
</span>
<span id='Ext-dirac-views-desktop-TaskBar-method-initComponent'>	initComponent : function() {
</span>
		var me = this;

		if (!GLOBAL.APP.configData.user.username) {

			GLOBAL.STATE_MANAGEMENT_ENABLED = false;

		}

		me.startMenu = new Ext.dirac.views.desktop.StartMenu();

		me.windowBar = new Ext.toolbar.Toolbar(me.getWindowBarConfig());

		me.items = [ {
			xtype : &#39;button&#39;,
			cls : &#39;ux-start-button&#39;,
			iconCls : &#39;ux-start-button-icon&#39;,
			menu : me.startMenu,
			menuAlign : &#39;bl-tl&#39;,
			text : me.startBtnText
		}, me.windowBar ];

		var sButtonThemeText = &quot;Grey&quot;;

		if (GLOBAL.WEB_THEME == &quot;ext-all-neptune&quot;)
			sButtonThemeText = &quot;Neptune&quot;;

		if (GLOBAL.WEB_THEME == &quot;ext-all&quot;)
			sButtonThemeText = &quot;Classic&quot;;

		var button_theme = {
			&quot;text&quot; : sButtonThemeText,
			&quot;menu&quot; : []
		};

		var oListTheme = [ &quot;Grey&quot;, &quot;Neptune&quot;, &quot;Classic&quot; ];

		for ( var i = 0; i &lt; oListTheme.length; i++) {
			button_theme.menu.push({
				text : oListTheme[i],
				handler : function() {

					var me = this;

					var oHref = location.href;

					var oQPosition = oHref.indexOf(&quot;?&quot;);

					if (oQPosition != -1) {
						location.href = oHref.substr(0, oQPosition) + &#39;?theme=&#39; + me.text + &quot;&amp;&quot; + GLOBAL.APP.MAIN_VIEW._state_related_url;
					} else {
						location.href = oHref + &#39;?theme=&#39; + me.text + &quot;&amp;&quot; + GLOBAL.APP.MAIN_VIEW._state_related_url;
					}

				}
			});
		}

		/*
		 * me.items.push({ xtype : &#39;tbtext&#39;, text : &quot;Theme&quot; });
		 * me.items.push(button_theme);
		 */

		var button_views = {
			&quot;text&quot; : GLOBAL.VIEW_ID,
			&quot;menu&quot; : []
		};

		var oListViews = [ &quot;desktop&quot;, &quot;tabs&quot; ];

		for ( var i = 0; i &lt; oListViews.length; i++) {
			button_views.menu.push({
				text : oListViews[i],
				handler : function() {

					var me = this;

					var oHref = location.href;

					var oQPosition = oHref.indexOf(&quot;?&quot;);

					if (oQPosition != -1) {
						location.href = oHref.substr(0, oQPosition) + &#39;?view=&#39; + me.text + &quot;&amp;theme=&quot; + sButtonThemeText;
					} else {
						location.href = oHref + &#39;?view=&#39; + me.text + &quot;&amp;theme=&quot; + sButtonThemeText;
					}

				}
			});
		}

		
		me.items.push({ xtype : &#39;tbtext&#39;, text : &quot;View&quot; });
		 
		me.items.push(button_views);
		 

		if (GLOBAL.APP.configData.user.username) {
			/*
			 * If the user is registered
			 */

			var button_data = {
				&quot;text&quot; : GLOBAL.APP.configData[&quot;user&quot;][&quot;group&quot;],
				&quot;menu&quot; : []
			};

			for ( var i = 0; i &lt; GLOBAL.APP.configData[&quot;validGroups&quot;].length; i++)
				button_data.menu.push({
					text : GLOBAL.APP.configData[&quot;validGroups&quot;][i],
					handler : function() {

						var me = this;

						var oHref = location.href;

						var oQPosition = oHref.indexOf(&quot;?&quot;);

						if (oQPosition != -1) {

							location.href = oHref.substr(0, oQPosition) + &#39;changeGroup?to=&#39; + me.text;
						} else {

							location.href = oHref + &#39;changeGroup?to=&#39; + me.text;
						}

					}
				});

			me.group_button = new Ext.button.Button(button_data);

			var setup_data = {
				&quot;text&quot; : GLOBAL.APP.configData[&quot;setup&quot;],
				&quot;menu&quot; : []
			};

			for ( var i = 0; i &lt; GLOBAL.APP.configData[&quot;validSetups&quot;].length; i++)
				setup_data.menu.push({
					text : GLOBAL.APP.configData[&quot;validSetups&quot;][i],
					handler : function() {

						var me = this;

						location.href = GLOBAL.BASE_URL + &#39;changeSetup?to=&#39; + me.text;

					}
				});

			me.setup_button = new Ext.button.Button(setup_data);
			me.items.push(&#39;-&#39;);
			me.items.push({
				xtype : &#39;tbtext&#39;,
				text : GLOBAL.APP.configData[&quot;user&quot;][&quot;username&quot;] + &quot;@&quot;
			});

			me.items.push(me.group_button);
			me.items.push(&#39;-&#39;);
			me.items.push(me.setup_button);

		} else {

			/*
			 * If the user is not registered
			 */
			if (location.protocol === &#39;http:&#39;) {

				var oHref = location.href;
				var oQPosition = oHref.indexOf(&quot;?&quot;);
				var sAddr = &quot;&quot;;

				if (oQPosition != -1) {

					sAddr = oHref.substr(0, oQPosition);

				} else {

					sAddr = oHref;

				}

				me.items.push(&#39;-&#39;);
				me.items.push({
					xtype : &#39;tbtext&#39;,
					text : &quot;Visitor (&lt;a href=&#39;https://&quot; + location.host.replace(&quot;8080&quot;, &quot;8443&quot;) + location.pathname + &quot;&#39;&gt;Secure connection&lt;/a&gt;)&quot;
				});

			} else {
				me.items.push(&#39;-&#39;);
				me.items.push({
					xtype : &#39;tbtext&#39;,
					text : &quot;Visitor&quot;
				});
			}
		}

		me.callParent();

	},

<span id='Ext-dirac-views-desktop-TaskBar-method-afterLayout'>	afterLayout : function() {
</span>		var me = this;
		me.callParent();
		me.windowBar.el.on(&#39;contextmenu&#39;, me.onButtonContextMenu, me);
	},

<span id='Ext-dirac-views-desktop-TaskBar-method-getTrayConfig'>	/**
</span>	 * This method returns the configuration object for the Tray toolbar. A
	 * derived class can override this method, call the base version to build the
	 * config and then modify the returned object before returning it.
	 */
	getTrayConfig : function() {
		var ret = {
			width : 80,
			items : this.trayItems
		};
		delete this.trayItems;
		return ret;
	},

<span id='Ext-dirac-views-desktop-TaskBar-method-getWindowBarConfig'>	getWindowBarConfig : function() {
</span>		return {
			flex : 1,
			cls : &#39;ux-desktop-windowbar&#39;,
			items : [ &#39;&amp;#160;&#39; ],
			layout : {
				overflowHandler : &#39;Scroller&#39;
			}
		};
	},

<span id='Ext-dirac-views-desktop-TaskBar-method-getWindowBtnFromEl'>	getWindowBtnFromEl : function(el) {
</span>		var c = this.windowBar.getChildByElement(el);
		return c || null;
	},

<span id='Ext-dirac-views-desktop-TaskBar-method-onButtonContextMenu'>	onButtonContextMenu : function(e) {
</span>		var me = this, t = e.getTarget(), btn = me.getWindowBtnFromEl(t);
		if (btn) {
			e.stopEvent();
			me.windowMenu.theWin = btn.win;
			me.windowMenu.showBy(t);
		}
	},

<span id='Ext-dirac-views-desktop-TaskBar-method-addTaskButton'>	/**
</span>	 * Function to add a (task) button within the task bar
	 * 
	 * @param {Ext.window.Window}
	 *          win The window to be referenced by the button
	 * @return {Ext.button.Button} Button object added to the task bar
	 */
	addTaskButton : function(win) {

		var config = {
			iconCls : win.iconCls,
			enableToggle : true,
			toggleGroup : &#39;all&#39;,
			width : 140,
			margins : &#39;0 2 0 3&#39;,
			text : Ext.util.Format.ellipsis(win.title, 20),
			listeners : {
				click : this.onWindowBtnClick,
				scope : this
			},
			win : win
		};
		var cmp = this.windowBar.add(config);
		cmp.toggle(true);
		return cmp;
	},

<span id='Ext-dirac-views-desktop-TaskBar-method-onWindowBtnClick'>	/**
</span>	 * Event handler executed when a button is clicked
	 * 
	 * @param {Ext.button.Button}
	 *          btn Button that has been clicked
	 */
	onWindowBtnClick : function(btn) {
		var win = btn.win;

		if (win.minimized || win.hidden) {

			win.minimized = false;
			win.show();

		} else if (win.active) {

			if (!win.desktopStickMode) {
				win.minimize();
			}

		} else {

			win.toFront();

		}

		if (!(&quot;isChildWindow&quot; in win))
			win.desktop.refreshUrlDesktopState();
	},

<span id='Ext-dirac-views-desktop-TaskBar-method-removeTaskButton'>	/**
</span>	 * Function to remove a (task) button within the task bar
	 * 
	 * @param {Ext.button.Button}
	 *          btn The button to be removed
	 * @return {Ext.button.Button} Button object removed from the task bar
	 */
	removeTaskButton : function(btn) {
		var found, me = this;
		me.windowBar.items.each(function(item) {
			if (item === btn) {
				found = item;
			}
			return !found;
		});
		if (found) {
			me.windowBar.remove(found);
		}
		return found;
	},

<span id='Ext-dirac-views-desktop-TaskBar-method-setActiveButton'>	/**
</span>	 * Function to activate a button
	 * 
	 * @param {Ext.button.Button}
	 *          btn The button to be removed
	 */
	setActiveButton : function(btn) {
		if (btn) {
			btn.toggle(true);
		} else {
			this.windowBar.items.each(function(item) {
				if (item.isButton) {
					item.toggle(false);
				}
			});
		}
	}
});
</pre>
</body>
</html>
