<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='DIRAC-ExampleApp-classes-ExampleApp'>/***
</span> * This is a simple example which describes how to use predefined widgets and how to create a new application. We used the following steps to create the first application:
 *
 *    - We called our first application ExampleApp.
 *    - We added the following line to the web.cfg: ExampleApp = DIRAC.ExampleApp
 *    - We created ExampleApp directory under DIRAC. We created two directories under ExampleApp called: classes and css.
 *    - classes directory contains the ExampleApp.js while the css directory contains the ExampleApp.css
 *    - We implemented the ExampleApp.js class
 *    - We implemented the ExampleAppHandler.py
 *
 *    ExampleHandler.py:
 *    from WebAppDIRAC.Lib.WebHandler import WebHandler, WErr, WOK, asyncGen
 *     from DIRAC import gConfig, S_OK, S_ERROR, gLogger
 *     from DIRAC.Core.Utilities import Time
 *     import json
 *
 *     class ExampleAppHandler(WebHandler):
 *
 *       AUTH_PROPS = &quot;authenticated&quot;
 *
 *       @asyncGen
 *       def web_getJobData(self):
 *         timestamp = Time.dateTime().strftime(&quot;%Y-%m-%d %H:%M [UTC]&quot;)
 *         total = 5
 *         values = []
 *         values = [{&quot;ExampleId&quot;:1,&quot;ExampleValue&quot;:&quot;Zoli&quot;},{&quot;ExampleId&quot;:2,&quot;ExampleValue&quot;:&#39;a&#39;},{&quot;ExampleId&quot;:3,&quot;ExampleValue&quot;:&#39;aaaa&#39;},{&quot;ExampleId&quot;:4,&quot;ExampleValue&quot;:&#39;bbbb&#39;},{&quot;ExampleId&quot;:5,&quot;ExampleValue&quot;:&#39;adsd&#39;}]
 *         callback = {&quot;success&quot;:&quot;true&quot;, &quot;result&quot;:values, &quot;total&quot;:total, &quot;date&quot;:timestamp }
 *         self.finish(callback)
 *
 *       @asyncGen
 *       def web_getSelectionData(self):
 *         callback = {&quot;firstName&quot;:[&quot;A&quot;,&quot;C&quot;,&quot;D&quot;],&quot;lastName&quot;:[&quot;wwww&quot;,&quot;dsds&quot;,&quot;sads&quot;]}
 *         self.finish(callback)
 *
 *
 *    NOTE: You can see the Source by clicking on the page title: DIRAC.ExampleApp.classes.ExampleApp.
 *
 */
Ext.define(&#39;DIRAC.ExampleApp.classes.ExampleApp&#39;, {
  extend : &#39;Ext.dirac.core.Module&#39;,

  requires :
    [&quot;Ext.dirac.utils.DiracToolButton&quot;, &quot;Ext.dirac.utils.DiracGridPanel&quot;, &quot;Ext.dirac.utils.DiracPagingToolbar&quot;,
     &quot;Ext.dirac.utils.DiracApplicationContextMenu&quot;,&quot;Ext.dirac.utils.DiracBaseSelector&quot;,&quot;Ext.dirac.utils.DiracAjaxProxy&quot;],

<span id='DIRAC-ExampleApp-classes-ExampleApp-method-loadState'>     /***
</span>      * @param{Object} data
      * It loads the data from the User Profile to the widget.
      */
     loadState : function(data) {

       var me = this;

       //loads the saved data related to the Grid Panel
       me.grid.loadState(data);

       //it loads the selector data
       me.leftPanel.loadState(data);

       //it loads the selector panel status.
       if (data.leftPanelCollapsed) {

         if (data.leftPanelCollapsed)
           me.leftPanel.collapse();

       }
     },
<span id='DIRAC-ExampleApp-classes-ExampleApp-method-getStateData'>     /**
</span>      * @return{Object}
      * It returns the data which will be saved in the User Profile.
      */
     getStateData : function() {

       var me = this;
       var oReturn = {};

       // data for grid columns
       oReturn.grid = me.grid.getStateData();
       // show/hide for selectors and their selected data (including NOT
       // button)
       oReturn.leftMenu = me.leftPanel.getStateData();

       oReturn.leftPanelCollapsed = me.leftPanel.collapsed;

       return oReturn;

     },
<span id='DIRAC-ExampleApp-classes-ExampleApp-property-dataFields'>     dataFields : [ { name : &#39;ExampleId&#39;, type : &#39;int&#39;},{ name : &#39;ExampleValue&#39;}],
</span>

<span id='DIRAC-ExampleApp-classes-ExampleApp-method-initComponent'>     initComponent : function() {
</span>
       var me = this;

       if (GLOBAL.VIEW_ID == &quot;desktop&quot;) {

         me.launcher.title = &quot;Example Application&quot;;
         me.launcher.maximized = false;

         var oDimensions = GLOBAL.APP.MAIN_VIEW.getViewMainDimensions();

         me.launcher.width = oDimensions[0];
         me.launcher.height = oDimensions[1] - GLOBAL.APP.MAIN_VIEW.taskbar.getHeight();

         me.launcher.x = 0;
         me.launcher.y = 0;

       }

       if (GLOBAL.VIEW_ID == &quot;tabs&quot;) {

         me.launcher.title = &quot;Example Application&quot;;
         me.launcher.maximized = false;

         var oDimensions = GLOBAL.APP.MAIN_VIEW.getViewMainDimensions();

         me.launcher.width = oDimensions[0];
         me.launcher.height = oDimensions[1] - GLOBAL.APP.MAIN_VIEW.taskbar.getHeight();

         me.launcher.x = 0;
         me.launcher.y = 0;

       }

       Ext.apply(me, {
         layout : &#39;border&#39;,
         bodyBorder : false,
         defaults : {
           collapsible : true,
           split : true
         }
       });

       me.callParent(arguments);

     },
<span id='DIRAC-ExampleApp-classes-ExampleApp-method-buildUI'>     /**
</span>      * It build the widget.
      */
     buildUI : function() {

       var me = this;

       /*
        * -----------------------------------------------------------------------------------------------------------
        * DEFINITION OF THE LEFT PANEL
        * -----------------------------------------------------------------------------------------------------------
        */

       var selectors = {
           firstName : &quot;First Name&quot;,
           lastName : &quot;Last Name&quot;
       };

       var textFields = {
           &#39;ids&#39; : &quot;PersonalId&quot;
       }

       var map = [ [ &quot;firstName&quot;, &quot;firstName&quot; ], [ &quot;lastName&quot;, &quot;lastName&quot; ]];

       me.leftPanel = Ext.create(&#39;Ext.dirac.utils.DiracBaseSelector&#39;,{
         scope : me,
         cmbSelectors : selectors,
         textFields : textFields,
         datamap : map,
         url : &quot;ExampleApp/getSelectionData&quot;
       });

       /*
        * -----------------------------------------------------------------------------------------------------------
        * DEFINITION OF THE GRID
        * -----------------------------------------------------------------------------------------------------------
        */

       var oProxy = Ext.create(&#39;Ext.dirac.utils.DiracAjaxProxy&#39;,{
         url : GLOBAL.BASE_URL + &#39;ExampleApp/getJobData&#39;
       });

       me.dataStore = Ext.create(&quot;Ext.dirac.utils.DiracJsonStore&quot;,{
         proxy : oProxy,
         fields : me.dataFields,
         scope: me});

       var pagingToolbar = {};

       var toolButtons = {
           &#39;Visible&#39;:[
                      {&quot;text&quot;:&quot;&quot;, &quot;handler&quot;:me.__executeAction, &quot;arguments&quot;:[&quot;example&quot;, &quot;&quot;],&quot;properties&quot;:{tooltip : &quot;Example&quot;, iconCls : &quot;dirac-icon-reschedule&quot;}}
                      ]
       };

       pagingToolbar = Ext.create(&quot;Ext.dirac.utils.DiracPagingToolbar&quot;,{
         toolButtons : toolButtons,
         store : me.dataStore,
         scope : me
       });

       var oColumns = {
           &quot;ExampleId&quot; : {&quot;dataIndex&quot; : &quot;ExampleId&quot;},
           &quot;ExampleValue&quot; : {&quot;dataIndex&quot;:&quot;ExampleValue&quot;}
       };


       var menuitems = {
           &#39;Visible&#39;:[
                      {&quot;text&quot;:&quot;Get info&quot;, &quot;handler&quot;:me.__executeAction, &quot;arguments&quot;:[&quot;Get info&quot;], &quot;properties&quot;:{tooltip:&#39;Click to show....&#39;}}
                      ]};

       me.contextGridMenu = new Ext.dirac.utils.DiracApplicationContextMenu({menu:menuitems,scope:me});

       me.grid = Ext.create(&#39;Ext.dirac.utils.DiracGridPanel&#39;, {
         store : me.dataStore,
         oColumns : oColumns,
         contextMenu : me.contextGridMenu,
         pagingToolbar : pagingToolbar,
         scope : me
       });
       
       me.leftPanel.setGrid(me.grid);
       
       me.add([ me.leftPanel, me.grid ]);
     },
<span id='DIRAC-ExampleApp-classes-ExampleApp-method-__executeAction'>     __executeAction : function(action){
</span>       var me = this;
       GLOBAL.APP.CF.alert(action+&quot; button pressed&quot;,&quot;info&quot;);
     }
});
</pre>
</body>
</html>
