<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='Ext-dirac-utils-DiracMultiSelect'>/**
</span> * A control that allows selection of multiple items in a list
 */
Ext.define(&#39;Ext.dirac.utils.DiracMultiSelect&#39;, {

      extend : &#39;Ext.ux.form.MultiSelect&#39;,
      alias : [&#39;widget.diracmultiselectfield&#39;, &#39;widget.diracmultiselect&#39;],
      requires : [&quot;Ext.selection.DataViewModel&quot;, &quot;Ext.form.field.Checkbox&quot;],
<span id='Ext-dirac-utils-DiracMultiSelect-property-ddReorder'>      ddReorder : false,
</span><span id='Ext-dirac-utils-DiracMultiSelect-property-listConfig'>      listConfig : {
</span>        selModel : new Ext.selection.DataViewModel({
              mode : &quot;MULTI&quot;,
              selectWithEvent : function(record, e, keepExisting) {
                var me = this;

                switch (me.selectionMode) {
                  case &#39;MULTI&#39; :
                    if (e.ctrlKey &amp;&amp; me.isSelected(record)) {
                      me.doDeselect(record, false);
                    } else if (e.shiftKey &amp;&amp; me.lastFocused) {
                      me.selectRange(me.lastFocused, record, e.ctrlKey);
                    } else if (e.ctrlKey) {
                      me.doSelect(record, true, false);
                    } else if (me.isSelected(record) &amp;&amp; !e.shiftKey &amp;&amp; !e.ctrlKey) {
                      me.doDeselect(record, false);
                    } else {
                      me.doSelect(record, false);
                    }
                    break;
                  case &#39;SIMPLE&#39; :
                    if (me.isSelected(record)) {
                      me.doDeselect(record);
                    } else {
                      me.doSelect(record, true);
                    }
                    break;
                  case &#39;SINGLE&#39; :
                    // if allowDeselect is on and this record isSelected,
                    // deselect
                    // it
                    if (me.allowDeselect &amp;&amp; me.isSelected(record)) {
                      me.doDeselect(record);
                      // select the record and do NOT maintain existing
                      // selections
                    } else {
                      me.doSelect(record, false);
                    }
                    break;
                }
              },

              selectRange : function(startRow, endRow, keepExisting, dir) {
                var me = this, store = me.store, selectedCount = 0, i, tmp, dontDeselect, records = [];

                if (me.isLocked()) {
                  return;
                }

                if (!keepExisting) {
                  me.deselectAll(false);
                }

                if (!Ext.isNumber(startRow)) {
                  startRow = store.indexOf(startRow);
                }
                if (!Ext.isNumber(endRow)) {
                  endRow = store.indexOf(endRow);
                }

                // swap values
                if (startRow &gt; endRow) {
                  tmp = endRow;
                  endRow = startRow;
                  startRow = tmp;
                }

                for (i = startRow; i &lt;= endRow; i++) {
                  if (me.isSelected(store.getAt(i))) {
                    selectedCount++;
                  }
                }

                if (!dir) {
                  dontDeselect = -1;
                } else {
                  dontDeselect = (dir == &#39;up&#39;) ? startRow : endRow;
                }

                for (i = startRow; i &lt;= endRow; i++) {
                  if (selectedCount == (endRow - startRow + 1)) {
                    if (i != dontDeselect) {
                      me.doDeselect(i, true);
                    }
                  } else {
                    records.push(store.getAt(i));
                  }
                }

                me.doMultiSelect(records, true);

              }
            }),
        getInnerTpl : function(displayField) {

          return &#39;&lt;table style=&quot;padding:0;margin:0&quot;&gt;&lt;tr&gt;&lt;td class=&quot;multselector-checkbox&quot; style=&quot;padding:0px 5px 0px 0px;vertical-align:middle&quot;&gt;&lt;/td&gt;&lt;td style=&quot;padding:3px 0px 0px 0px;vertical-align:middle&quot;&gt;{&#39; + displayField + &#39;}&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#39;;

        },
        listeners : {

          refresh : function() {

            var me = this;
            var renderSelector = Ext.query(&quot;#&quot; + me.id + &#39; td.multselector-checkbox&#39;);
            for (var i in renderSelector) {
              Ext.create(&#39;Ext.form.field.Checkbox&#39;, {
                    renderTo : renderSelector[i],
                    margin : 0,
                    padding : 0
                  });
            }

          },

          select : function(r, record, eOpts) {
            console.log(&quot;SELECT&quot;);

            var node = this.getNode(record);

            if (node) {
              var oPomElemId = Ext.fly(node).down(&quot;table table&quot;).id;
              var oCheckBox = Ext.getCmp(oPomElemId);
              oCheckBox.setValue(true);

            }

          },

          deselect : function(r, record, eOpts) {

            console.log(&quot;DE - SELECT&quot;);
            var node = this.getNode(record);

            if (node) {
              var oPomElemId = Ext.fly(node).down(&quot;table table&quot;).id;
              var oCheckBox = Ext.getCmp(oPomElemId);

              oCheckBox.setValue(false);

            }

          },

          itemclick : function(viewObject, record, item, index, e, eOpts) {

            if (e.target.nodeName == &quot;INPUT&quot;)
              e.ctrlKey = true;

          }
        }

      }

    });
</pre>
</body>
</html>
